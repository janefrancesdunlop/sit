<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <input id="user-input" placeholder="type here" />
        <a href="javascript:generateVideo();">Generate Video</a>
        <div id="video-container"></div>
    </head>
    <body>
    <script src="scripts/uheprng.js"></script>
    <script type="text/javascript">
        const videoUrls = [
            // replace these with the path or url to each of your fragment videos
            "<iframe src="https://player.vimeo.com/video/678318057?h=4b23225724" width="640" height="564" frameborder="0" allow="autoplay" allowfullscreen></iframe>",
            "<iframe src="https://player.vimeo.com/video/678318344?h=21e9b40fcb" width="640" height="564" frameborder="0" allow="autoplay" allowfullscreen></iframe>",
            "<iframe src="https://player.vimeo.com/video/678318898?h=86057d4e95" width="640" height="564" frameborder="0" allow="autoplay" allowfullscreen></iframe>",
        ]
        const randomizer = uheprng()
        const numVideosToCombine = 3
        let selectedVideos = []
        let videosPlayed = 0
        

        const getRandomNumbers = () => {
            const userInput = document.getElementById("user-input").value
            randomizer.initState();
            randomizer.hashString(userInput)

            return Array(numVideosToCombine).fill().map(n => randomizer(videoUrls))
        }

        const generateVideo = () => {
            const videoIndexes = getRandomNumbers()
            const videoContainerHtml = document.getElementById("video-container")
            selectedVideos.map(video => pauseVideo(video))
            selectedVideos = videoIndexes.map(index => {
                const video = document.createElement('video')
                video.src = videoUrls[index]
                video.id = `video-${index}`
                videoContainerHtml.appendChild(video)
                video.load()

                return video
            })
            videosPlayed = 0

            playNextVideo()
        }

        const playNextVideo = () => {
            const previousVideo = selectedVideos[videosPlayed -1]
            previousVideo && pauseVideo(previousVideo)

            const currentVideo = selectedVideos[videosPlayed]
            if (!currentVideo) return false

            playVideo(currentVideo)
            videosPlayed++

            return currentVideo
        }

        const playVideo = (video) => {
            video.classList.add("playing");
            video.play()
            video.addEventListener('ended', playNextVideo, false);
        }

        const pauseVideo = (video) => {
            video.removeEventListener('ended', playNextVideo);
            !video.paused && video.pause()
            video.classList.remove("playing");
        }
    </script>
    </body>
</html>

